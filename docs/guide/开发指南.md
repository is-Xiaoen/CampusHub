# æ ¡å›­æ´»åŠ¨å¹³å° - å¼€å‘æŒ‡å—

## ç›®å½•

1. [æ¶æ„æ¦‚è¿°](#1-æ¶æ„æ¦‚è¿°)
2. [é¡¹ç›®ç›®å½•ç»“æ„](#2-é¡¹ç›®ç›®å½•ç»“æ„)
3. [å¼€å‘ç¯å¢ƒæ­å»º](#3-å¼€å‘ç¯å¢ƒæ­å»º)
4. [API æœåŠ¡å¼€å‘æµç¨‹](#4-api-æœåŠ¡å¼€å‘æµç¨‹)
5. [RPC æœåŠ¡å¼€å‘æµç¨‹](#5-rpc-æœåŠ¡å¼€å‘æµç¨‹)
6. [è®¤è¯é‰´æƒæœºåˆ¶](#6-è®¤è¯é‰´æƒæœºåˆ¶)
7. [ç½‘å…³é…ç½®](#7-ç½‘å…³é…ç½®)
8. [å„æœåŠ¡èŒè´£è¯´æ˜](#8-å„æœåŠ¡èŒè´£è¯´æ˜)
9. [å¸¸è§é—®é¢˜](#9-å¸¸è§é—®é¢˜)

---

## 1. æ¶æ„æ¦‚è¿°

### 1.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              å®¢æˆ·ç«¯                                      â”‚
â”‚                     (Web / App / å°ç¨‹åº)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚ HTTPS
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Nginx ç½‘å…³ (:8888)                                  â”‚
â”‚                                                                          â”‚
â”‚   èŒè´£ï¼šè·¯ç”±åˆ†å‘ï¼ˆä¸åšä¸šåŠ¡é€»è¾‘ã€ä¸åšé‰´æƒï¼‰                                   â”‚
â”‚                                                                          â”‚
â”‚   /api/v1/user/*     â†’ user-api:8001                                    â”‚
â”‚   /api/v1/activity/* â†’ activity-api:8002                                â”‚
â”‚   /api/v1/chat/*     â†’ chat-api:8003                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚                       â”‚
        â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   user-api    â”‚       â”‚ activity-api  â”‚       â”‚   chat-api    â”‚
â”‚    :8001      â”‚       â”‚    :8002      â”‚       â”‚    :8003      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç™»å½•æ³¨å†Œ     â”‚        â”‚ â€¢ æ´»åŠ¨åˆ—è¡¨     â”‚       â”‚ â€¢ èŠå¤©å®¤åˆ—è¡¨    â”‚
â”‚ â€¢ Tokenç­¾å‘    â”‚       â”‚ â€¢ æ´»åŠ¨è¯¦æƒ…     â”‚       â”‚ â€¢ æ¶ˆæ¯å†å²      â”‚
â”‚ â€¢ ç”¨æˆ·ä¿¡æ¯     â”‚        â”‚ â€¢ åˆ›å»º/æ›´æ–°    â”‚       â”‚ â€¢ å‘é€æ¶ˆæ¯      â”‚
â”‚               â”‚       â”‚ â€¢ æŠ¥å/ç­¾åˆ°    â”‚        â”‚               â”‚
â”‚ jwt:Auth âœ“    â”‚       â”‚ jwt:Auth âœ“    â”‚       â”‚ jwt:Auth âœ“    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ gRPC                  â”‚ gRPC                  â”‚ gRPC
        â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   user-rpc    â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚ activity-rpc  â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚   chat-rpc    â”‚
â”‚    :9001      â”‚       â”‚    :9002      â”‚       â”‚    :9003      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç”¨æˆ·CRUD     â”‚       â”‚ â€¢ æ´»åŠ¨CRUD     â”‚       â”‚ â€¢ æ¶ˆæ¯å­˜å‚¨     â”‚
â”‚ â€¢ å¯†ç éªŒè¯     â”‚        â”‚ â€¢ æŠ¥åé€»è¾‘     â”‚       â”‚ â€¢ èŠå¤©å®¤ç®¡ç†    â”‚
â”‚ â€¢ ä¿¡æ¯æŸ¥è¯¢     â”‚        â”‚ â€¢ ç­¾åˆ°é€»è¾‘     â”‚       â”‚ â€¢ æ¨é€é€šçŸ¥      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  MySQL / Redis / Etcd â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **Nginx åªåšè·¯ç”±** | ä¸å†™ä¸šåŠ¡ä»£ç ï¼Œä¸åšé‰´æƒï¼Œåªè½¬å‘è¯·æ±‚ |
| **API å±‚åšèšåˆ** | HTTP åè®®å¤„ç†ã€å‚æ•°æ ¡éªŒã€è°ƒç”¨ RPCã€æ•°æ®èšåˆ |
| **RPC å±‚åšä¸šåŠ¡** | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€æ•°æ®åº“æ“ä½œã€æœåŠ¡é—´è°ƒç”¨ |
| **JWT å„æœåŠ¡éªŒè¯** | ä½¿ç”¨ go-zero å†…ç½® jwt:Authï¼Œå…±äº«å¯†é’¥ |

### 1.3 è¯·æ±‚å®Œæ•´é“¾è·¯

```
1. ç”¨æˆ·ç™»å½•
   POST /api/v1/user/login
   â†’ Nginx è½¬å‘ â†’ user-apiï¼ˆæ— éœ€jwt:Authï¼‰
   â†’ user-api è°ƒç”¨ user-rpc éªŒè¯å¯†ç 
   â†’ user-api ç­¾å‘ JWT Token è¿”å›ç»™å®¢æˆ·ç«¯

2. ç”¨æˆ·è·å–æ´»åŠ¨åˆ—è¡¨ï¼ˆéœ€ç™»å½•ï¼‰
   GET /api/v1/activity/list
   Header: Authorization: Bearer <token>
   â†’ Nginx è½¬å‘ â†’ activity-api
   â†’ go-zero jwt:Auth ä¸­é—´ä»¶è‡ªåŠ¨éªŒè¯ Token
   â†’ éªŒè¯æˆåŠŸï¼šactivity-api ä» ctx å–å‡º userId
   â†’ activity-api è°ƒç”¨ activity-rpc è·å–æ•°æ®
   â†’ è¿”å›æ´»åŠ¨åˆ—è¡¨
```

---

## 2. é¡¹ç›®ç›®å½•ç»“æ„

### 2.1 å®Œæ•´ç›®å½•ç»“æ„

```
activity-platform/
â”‚
â”œâ”€â”€ app/                              # åº”ç”¨æœåŠ¡ç›®å½•
â”‚   â”‚
â”‚   â”œâ”€â”€ user/                         # ç”¨æˆ·æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ api/                      # HTTP æ¥å£å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ desc/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ user.api          # API å®šä¹‰æ–‡ä»¶ï¼ˆæ‰‹åŠ¨ç¼–å†™ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ etc/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ user-api.yaml     # é…ç½®æ–‡ä»¶ï¼ˆæ‰‹åŠ¨ç¼–å†™ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ internal/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ config.go     # é…ç½®ç»“æ„ä½“ï¼ˆgoctl ç”Ÿæˆï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ handler/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ routes.go     # è·¯ç”±æ³¨å†Œï¼ˆgoctl ç”Ÿæˆï¼‰
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ *.go          # å„æ¥å£å¤„ç†å™¨ï¼ˆgoctl ç”Ÿæˆï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ logic/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ *.go          # ä¸šåŠ¡é€»è¾‘ï¼ˆgoctl ç”Ÿæˆéª¨æ¶ï¼Œéœ€æ‰‹åŠ¨å®ç°ï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ svc/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ servicecontext.go  # æœåŠ¡ä¸Šä¸‹æ–‡ï¼ˆgoctl ç”Ÿæˆï¼Œéœ€æ‰‹åŠ¨è¡¥å……ï¼‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ types/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ types.go      # è¯·æ±‚å“åº”ç±»å‹ï¼ˆgoctl ç”Ÿæˆï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ user.go               # å…¥å£æ–‡ä»¶ï¼ˆæ‰‹åŠ¨ç¼–å†™/goctl ç”Ÿæˆï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ rpc/                      # gRPC æœåŠ¡å±‚
â”‚   â”‚       â”œâ”€â”€ etc/
â”‚   â”‚       â”‚   â””â”€â”€ user.yaml         # é…ç½®æ–‡ä»¶
â”‚   â”‚       â”œâ”€â”€ internal/
â”‚   â”‚       â”‚   â”œâ”€â”€ config/
â”‚   â”‚       â”‚   â”œâ”€â”€ logic/            # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆéœ€æ‰‹åŠ¨å®ç°ï¼‰
â”‚   â”‚       â”‚   â”œâ”€â”€ model/            # æ•°æ®åº“æ“ä½œï¼ˆéœ€æ‰‹åŠ¨å®ç°ï¼‰
â”‚   â”‚       â”‚   â”œâ”€â”€ server/           # gRPC æœåŠ¡å®ç°ï¼ˆgoctl ç”Ÿæˆï¼‰
â”‚   â”‚       â”‚   â””â”€â”€ svc/
â”‚   â”‚       â”œâ”€â”€ pb/                   # protobuf ç”Ÿæˆçš„ä»£ç 
â”‚   â”‚       â”œâ”€â”€ user.proto            # proto å®šä¹‰æ–‡ä»¶
â”‚   â”‚       â””â”€â”€ user.go               # å…¥å£æ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ activity/                     # æ´»åŠ¨æœåŠ¡ï¼ˆç»“æ„åŒ userï¼‰
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ rpc/
â”‚   â”‚
â”‚   â”œâ”€â”€ chat/                         # èŠå¤©æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ rpc/
â”‚   â”‚   â””â”€â”€ ws/                       # WebSocket æœåŠ¡ï¼ˆç‰¹æ®Šï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ demo/rpc/                     # ç¤ºä¾‹æœåŠ¡ï¼ˆå‚è€ƒç”¨ï¼‰
â”‚
â”œâ”€â”€ common/                           # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ errorx/                       # é”™è¯¯ç å®šä¹‰
â”‚   â”œâ”€â”€ response/                     # ç»Ÿä¸€å“åº”å°è£…
â”‚   â”œâ”€â”€ ctxdata/                      # Context å·¥å…·
â”‚   â”œâ”€â”€ constants/                    # å¸¸é‡å®šä¹‰
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ jwt/                      # JWT å·¥å…·ï¼ˆæ¨æ˜¥è·¯å®ç°ï¼‰
â”‚       â”œâ”€â”€ encrypt/                  # åŠ å¯†å·¥å…·
â”‚       â””â”€â”€ validate/                 # éªŒè¯å·¥å…·
â”‚
â”œâ”€â”€ deploy/                           # éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ nginx/
â”‚   â”‚   â””â”€â”€ gateway.conf              # Nginx ç½‘å…³é…ç½®
â”‚   â”œâ”€â”€ docker/
â”‚   â”‚   â”œâ”€â”€ docker-compose.yaml       # åŸºç¡€è®¾æ–½
â”‚   â”‚   â””â”€â”€ docker-compose-app.yaml   # åº”ç”¨æœåŠ¡
â”‚   â””â”€â”€ sql/                          # æ•°æ®åº“è„šæœ¬
â”‚
â”œâ”€â”€ docs/                             # æ–‡æ¡£
â”‚   â””â”€â”€ guide/
â”‚       â””â”€â”€ å¼€å‘æŒ‡å—.md
â”‚
â”œâ”€â”€ scripts/                          # è„šæœ¬å·¥å…·
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

### 2.2 API æœåŠ¡ç›®å½•è¯¦è§£

```
user/api/
â”œâ”€â”€ desc/
â”‚   â””â”€â”€ user.api          # â‘  æ‰‹åŠ¨ç¼–å†™ï¼šå®šä¹‰æ¥å£ã€è·¯ç”±ã€è¯·æ±‚å“åº”ç»“æ„
â”‚
â”œâ”€â”€ etc/
â”‚   â””â”€â”€ user-api.yaml     # â‘¡ æ‰‹åŠ¨ç¼–å†™ï¼šæœåŠ¡é…ç½®ï¼ˆç«¯å£ã€JWTå¯†é’¥ã€RPCåœ°å€ï¼‰
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.go     # â‘¢ goctl ç”Ÿæˆï¼šé…ç½®ç»“æ„ä½“ï¼Œå¯¹åº” yaml
â”‚   â”‚
â”‚   â”œâ”€â”€ handler/
â”‚   â”‚   â”œâ”€â”€ routes.go     # â‘£ goctl ç”Ÿæˆï¼šè·¯ç”±æ³¨å†Œ
â”‚   â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”‚   â”œâ”€â”€ registerhandler.go   # goctl ç”Ÿæˆï¼šæ³¨å†Œæ¥å£å¤„ç†å™¨
â”‚   â”‚   â”‚   â””â”€â”€ loginhandler.go      # goctl ç”Ÿæˆï¼šç™»å½•æ¥å£å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ user/
â”‚   â”‚       â”œâ”€â”€ getprofilehandler.go # goctl ç”Ÿæˆï¼šè·å–ä¿¡æ¯å¤„ç†å™¨
â”‚   â”‚       â””â”€â”€ updateprofilehandler.go
â”‚   â”‚
â”‚   â”œâ”€â”€ logic/
â”‚   â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”‚   â”œâ”€â”€ registerlogic.go     # â‘¤ goctl ç”Ÿæˆéª¨æ¶ï¼Œéœ€æ‰‹åŠ¨å®ç°
â”‚   â”‚   â”‚   â””â”€â”€ loginlogic.go        # â‘¤ éœ€æ‰‹åŠ¨å®ç°ï¼šå¯†ç éªŒè¯ã€ç­¾å‘Token
â”‚   â”‚   â””â”€â”€ user/
â”‚   â”‚       â”œâ”€â”€ getprofilelogic.go   # â‘¤ éœ€æ‰‹åŠ¨å®ç°ï¼šè°ƒç”¨RPCè·å–ç”¨æˆ·ä¿¡æ¯
â”‚   â”‚       â””â”€â”€ updateprofilelogic.go
â”‚   â”‚
â”‚   â”œâ”€â”€ svc/
â”‚   â”‚   â””â”€â”€ servicecontext.go        # â‘¥ goctl ç”Ÿæˆéª¨æ¶ï¼Œéœ€è¡¥å…… RPC å®¢æˆ·ç«¯
â”‚   â”‚
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ types.go                 # â‘¦ goctl ç”Ÿæˆï¼šè¯·æ±‚å“åº”ç»“æ„ä½“
â”‚
â”œâ”€â”€ user.go               # â‘§ å…¥å£æ–‡ä»¶
â””â”€â”€ README.md
```

---

## 3. å¼€å‘ç¯å¢ƒæ­å»º

### 3.1 å®‰è£…ä¾èµ–

```bash
# 1. å®‰è£… Go 1.21+
# ä¸‹è½½åœ°å€ï¼šhttps://golang.org/dl/

# 2. å®‰è£… goctlï¼ˆgo-zero ä»£ç ç”Ÿæˆå·¥å…·ï¼‰
go install github.com/zeromicro/go-zero/tools/goctl@latest

# éªŒè¯å®‰è£…
goctl --version

# 3. å®‰è£… protocï¼ˆProtocol Buffers ç¼–è¯‘å™¨ï¼‰
# Windows: ä¸‹è½½ https://github.com/protocolbuffers/protobuf/releases
# è§£å‹åå°† bin ç›®å½•æ·»åŠ åˆ° PATH

# 4. å®‰è£… protoc-gen-go æ’ä»¶
go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
```

### 3.2 å¯åŠ¨åŸºç¡€è®¾æ–½

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd activity-platform

# å¯åŠ¨ MySQL + Redis + Etcd + Jaeger
cd deploy/docker
docker-compose up -d

# éªŒè¯æœåŠ¡å¯åŠ¨
docker-compose ps
```

### 3.3 ä¸‹è½½é¡¹ç›®ä¾èµ–

```bash
cd activity-platform
go mod tidy
```

---

## 4. API æœåŠ¡å¼€å‘æµç¨‹

### 4.1 å®Œæ•´å¼€å‘æ­¥éª¤

ä»¥ **user-api** ä¸ºä¾‹ï¼Œä»é›¶å¼€å§‹å¼€å‘ï¼š

#### Step 1: ç¼–å†™ .api æ–‡ä»¶ï¼ˆå·²å®Œæˆï¼‰

æ–‡ä»¶ä½ç½®ï¼š`app/user/api/desc/user.api`

```go
syntax = "v1"

info (
    title:   "ç”¨æˆ·æœåŠ¡ API"
    desc:    "ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¸ªäººä¿¡æ¯ç®¡ç†"
    author:  "æ¨æ˜¥è·¯"
    version: "v1"
)

// ==================== ç±»å‹å®šä¹‰ ====================

type LoginReq {
    Phone    string `json:"phone"`
    Password string `json:"password"`
}

type LoginResp {
    UserId      int64  `json:"userId"`
    AccessToken string `json:"accessToken"`
    ExpiresAt   int64  `json:"expiresAt"`
}

// ==================== æœåŠ¡å®šä¹‰ ====================

// å…¬å¼€æ¥å£ï¼ˆæ— éœ€ç™»å½•ï¼‰
@server (
    prefix: /api/v1/user
    group:  public
)
service user-api {
    @doc "ç”¨æˆ·ç™»å½•"
    @handler Login
    post /login (LoginReq) returns (LoginResp)
}

// éœ€è¦ç™»å½•çš„æ¥å£
@server (
    prefix: /api/v1/user
    group:  user
    jwt:    Auth          // ğŸ‘ˆ å…³é”®ï¼šå£°æ˜éœ€è¦ JWT é‰´æƒ
)
service user-api {
    @doc "è·å–ä¸ªäººä¿¡æ¯"
    @handler GetProfile
    get /profile returns (GetProfileResp)
}
```

#### Step 2: ä½¿ç”¨ goctl ç”Ÿæˆä»£ç 

```bash
cd app/user/api

# ç”Ÿæˆä»£ç 
goctl api go -api desc/user.api -dir . -style go_zero

# ç”Ÿæˆåçš„æ–‡ä»¶ç»“æ„
# internal/
#   â”œâ”€â”€ config/config.go        âœ“ ç”Ÿæˆ
#   â”œâ”€â”€ handler/
#   â”‚   â”œâ”€â”€ routes.go           âœ“ ç”Ÿæˆ
#   â”‚   â”œâ”€â”€ public/loginhandler.go  âœ“ ç”Ÿæˆ
#   â”‚   â””â”€â”€ user/getprofilehandler.go  âœ“ ç”Ÿæˆ
#   â”œâ”€â”€ logic/
#   â”‚   â”œâ”€â”€ public/loginlogic.go    âœ“ ç”Ÿæˆï¼ˆéœ€å®ç°ï¼‰
#   â”‚   â””â”€â”€ user/getprofilelogic.go âœ“ ç”Ÿæˆï¼ˆéœ€å®ç°ï¼‰
#   â”œâ”€â”€ svc/servicecontext.go   âœ“ ç”Ÿæˆï¼ˆéœ€è¡¥å……ï¼‰
#   â””â”€â”€ types/types.go          âœ“ ç”Ÿæˆ
# user.go                       âœ“ ç”Ÿæˆ
```

#### Step 3: æŸ¥çœ‹ç”Ÿæˆçš„ä»£ç 

**config.go** - é…ç½®ç»“æ„ä½“

```go
package config

import (
    "github.com/zeromicro/go-zero/rest"
)

type Config struct {
    rest.RestConf
    Auth struct {                    // ğŸ‘ˆ å¯¹åº” yaml ä¸­çš„ Auth
        AccessSecret string
        AccessExpire int64
    }
}
```

**types.go** - è¯·æ±‚å“åº”ç±»å‹

```go
package types

type LoginReq struct {
    Phone    string `json:"phone"`
    Password string `json:"password"`
}

type LoginResp struct {
    UserId      int64  `json:"userId"`
    AccessToken string `json:"accessToken"`
    ExpiresAt   int64  `json:"expiresAt"`
}
```

**loginhandler.go** - HTTP å¤„ç†å™¨ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€ä¿®æ”¹ï¼‰

```go
package public

func LoginHandler(svcCtx *svc.ServiceContext) http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        var req types.LoginReq
        if err := httpx.Parse(r, &req); err != nil {
            httpx.ErrorCtx(r.Context(), w, err)
            return
        }

        l := logic.NewLoginLogic(r.Context(), svcCtx)
        resp, err := l.Login(&req)
        if err != nil {
            httpx.ErrorCtx(r.Context(), w, err)
        } else {
            httpx.OkJsonCtx(r.Context(), w, resp)
        }
    }
}
```

**loginlogic.go** - ä¸šåŠ¡é€»è¾‘ï¼ˆéœ€è¦æ‰‹åŠ¨å®ç°ï¼‰

```go
package public

type LoginLogic struct {
    logx.Logger
    ctx    context.Context
    svcCtx *svc.ServiceContext
}

func NewLoginLogic(ctx context.Context, svcCtx *svc.ServiceContext) *LoginLogic {
    return &LoginLogic{
        Logger: logx.WithContext(ctx),
        ctx:    ctx,
        svcCtx: svcCtx,
    }
}

// Login ç”¨æˆ·ç™»å½•
// TODO(æ¨æ˜¥è·¯): å®ç°ç™»å½•é€»è¾‘
func (l *LoginLogic) Login(req *types.LoginReq) (resp *types.LoginResp, err error) {
    // 1. è°ƒç”¨ user-rpc éªŒè¯ç”¨æˆ·å¯†ç 
    // user, err := l.svcCtx.UserRpc.Login(l.ctx, &userpb.LoginReq{
    //     Phone:    req.Phone,
    //     Password: req.Password,
    // })

    // 2. ç­¾å‘ JWT Token
    // token, err := jwtx.GenerateToken(...)

    // 3. è¿”å›å“åº”
    return &types.LoginResp{
        UserId:      0,  // TODO: å¡«å…¥çœŸå®æ•°æ®
        AccessToken: "", // TODO: å¡«å…¥ç”Ÿæˆçš„ Token
        ExpiresAt:   0,  // TODO: å¡«å…¥è¿‡æœŸæ—¶é—´
    }, nil
}
```

#### Step 4: è¡¥å…… ServiceContext

```go
package svc

import (
    "activity-platform/app/user/api/internal/config"
    // "activity-platform/app/user/rpc/userclient"  // TODO: RPC å®ç°åå–æ¶ˆæ³¨é‡Š
    // "github.com/zeromicro/go-zero/zrpc"
)

type ServiceContext struct {
    Config  config.Config
    // UserRpc userclient.User  // TODO: RPC å®¢æˆ·ç«¯
}

func NewServiceContext(c config.Config) *ServiceContext {
    return &ServiceContext{
        Config: c,
        // UserRpc: userclient.NewUser(zrpc.MustNewClient(c.UserRpc)),
    }
}
```

#### Step 5: é…ç½®æ–‡ä»¶

æ–‡ä»¶ï¼š`app/user/api/etc/user-api.yaml`

```yaml
Name: user-api
Host: 0.0.0.0
Port: 8001

# JWT é…ç½®ï¼ˆé‡è¦ï¼šæ‰€æœ‰ API æœåŠ¡å¿…é¡»ä¸€è‡´ï¼‰
Auth:
  AccessSecret: "your-secret-key-must-be-same-across-all-services"
  AccessExpire: 7200

# RPC æœåŠ¡é…ç½®
UserRpc:
  Etcd:
    Hosts:
      - 127.0.0.1:2379
    Key: user.rpc
```

#### Step 6: å¯åŠ¨æœåŠ¡

```bash
cd app/user/api
go run user.go -f etc/user-api.yaml
```

#### Step 7: æµ‹è¯•æ¥å£

```bash
# æµ‹è¯•ç™»å½•ï¼ˆå…¬å¼€æ¥å£ï¼Œæ— éœ€ Tokenï¼‰
curl -X POST http://localhost:8001/api/v1/user/login \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000","password":"123456"}'

# æµ‹è¯•è·å–ä¸ªäººä¿¡æ¯ï¼ˆéœ€è¦ Tokenï¼‰
curl http://localhost:8001/api/v1/user/profile \
  -H "Authorization: Bearer <your-jwt-token>"
```

---

## 5. RPC æœåŠ¡å¼€å‘æµç¨‹

### 5.1 å®Œæ•´å¼€å‘æ­¥éª¤

ä»¥ **user-rpc** ä¸ºä¾‹ï¼š

#### Step 1: ç¼–å†™ .proto æ–‡ä»¶

æ–‡ä»¶ï¼š`app/user/rpc/user.proto`

```protobuf
syntax = "proto3";

package user;

option go_package = "./pb";

service UserService {
    rpc Login(LoginReq) returns (LoginResp);
    rpc GetUserInfo(GetUserInfoReq) returns (GetUserInfoResp);
    rpc Register(RegisterReq) returns (RegisterResp);
}

message LoginReq {
    string phone = 1;
    string password = 2;
}

message LoginResp {
    int64 user_id = 1;
    string phone = 2;
    string nickname = 3;
}

// ... å…¶ä»–æ¶ˆæ¯å®šä¹‰
```

#### Step 2: ç”Ÿæˆä»£ç 

```bash
cd app/user/rpc

# ä½¿ç”¨ goctl ç”Ÿæˆ RPC ä»£ç 
goctl rpc protoc user.proto --go_out=. --go-grpc_out=. --zrpc_out=. -style go_zero
```

#### Step 3: å®ç°ä¸šåŠ¡é€»è¾‘

åœ¨ `internal/logic/` ç›®å½•ä¸‹å®ç°å„æ–¹æ³•ã€‚

#### Step 4: å®ç°æ•°æ®åº“æ“ä½œ

åœ¨ `internal/model/` ç›®å½•ä¸‹å®ç° CRUDã€‚

---

## 6. è®¤è¯é‰´æƒæœºåˆ¶

### 6.1 è®¤è¯æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           è®¤è¯é‰´æƒæµç¨‹                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ç™»å½•è·å– Token
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    POST /login      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    éªŒè¯å¯†ç      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å®¢æˆ·ç«¯  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ user-api â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ user-rpc â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–²                               â”‚
       â”‚                               â”‚ å¯†ç æ­£ç¡®
       â”‚         è¿”å› JWT Token        â–¼
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  ç­¾å‘ Token
                                  (åœ¨ user-api çš„ logic ä¸­)

2. è®¿é—®éœ€è¦ç™»å½•çš„æ¥å£
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    GET /profile     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å®¢æˆ·ç«¯  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  ä»»æ„API  â”‚
   â”‚        â”‚  Authorization:     â”‚  æœåŠ¡     â”‚
   â”‚        â”‚  Bearer <token>     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
                                       â–¼
                            go-zero jwt:Auth ä¸­é—´ä»¶
                            è‡ªåŠ¨éªŒè¯ Token
                                       â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚                         â”‚
                          â–¼                         â–¼
                    éªŒè¯æˆåŠŸ                    éªŒè¯å¤±è´¥
                 userId æ”¾å…¥ ctx            è¿”å› 401 Unauthorized
                          â”‚
                          â–¼
                   æ‰§è¡Œ logic ä¸šåŠ¡é€»è¾‘
                   ctx.Value("userId")
```

### 6.2 å„å±‚èŒè´£

| å±‚çº§ | èŒè´£ | ä»£ç ä½ç½® |
|------|------|----------|
| **Nginx** | è·¯ç”±åˆ†å‘ | `deploy/nginx/gateway.conf` |
| **API handler** | HTTP å¤„ç†ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ | `internal/handler/` |
| **go-zero jwt:Auth** | Token éªŒè¯ï¼ˆæ¡†æ¶å†…ç½®ï¼‰ | åœ¨ .api æ–‡ä»¶å£°æ˜ `jwt: Auth` |
| **API logic** | ç­¾å‘ Tokenï¼ˆä»… user-apiï¼‰ | `user/api/internal/logic/public/loginlogic.go` |
| **API logic** | è·å– userId | `l.ctx.Value("userId")` |
| **RPC** | ä¸åšé‰´æƒ | - |

### 6.3 Token ç­¾å‘ä»£ç ç¤ºä¾‹

åœ¨ `user-api` çš„ `loginlogic.go` ä¸­ï¼š

```go
func (l *LoginLogic) Login(req *types.LoginReq) (*types.LoginResp, error) {
    // 1. è°ƒç”¨ RPC éªŒè¯å¯†ç 
    user, err := l.svcCtx.UserRpc.Login(l.ctx, &userpb.LoginReq{
        Phone:    req.Phone,
        Password: req.Password,
    })
    if err != nil {
        return nil, errorx.NewCodeError(errorx.UserNotFound, "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯")
    }

    // 2. ç­¾å‘ JWT Token
    now := time.Now().Unix()
    accessExpire := l.svcCtx.Config.Auth.AccessExpire
    accessToken, err := l.generateToken(user.UserId, now, accessExpire)
    if err != nil {
        return nil, err
    }

    return &types.LoginResp{
        UserId:      user.UserId,
        AccessToken: accessToken,
        ExpiresAt:   now + accessExpire,
    }, nil
}

// generateToken ç”Ÿæˆ JWT Token
func (l *LoginLogic) generateToken(userId int64, iat, expire int64) (string, error) {
    claims := jwt.MapClaims{
        "userId": userId,           // ğŸ‘ˆ å…³é”®ï¼šå¿…é¡»åŒ…å« userId
        "iat":    iat,
        "exp":    iat + expire,
    }
    token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)
    return token.SignedString([]byte(l.svcCtx.Config.Auth.AccessSecret))
}
```

### 6.4 è·å–å½“å‰ç”¨æˆ· ID

åœ¨ä»»æ„ API æœåŠ¡çš„ logic ä¸­ï¼š

```go
func (l *GetProfileLogic) GetProfile() (*types.GetProfileResp, error) {
    // ä» context è·å– userIdï¼ˆgo-zero jwt:Auth è‡ªåŠ¨æ”¾å…¥ï¼‰
    userId, err := l.getUserIdFromCtx()
    if err != nil {
        return nil, err
    }

    // è°ƒç”¨ RPC è·å–ç”¨æˆ·ä¿¡æ¯
    user, err := l.svcCtx.UserRpc.GetUserInfo(l.ctx, &userpb.GetUserInfoReq{
        UserId: userId,
    })
    // ...
}

// getUserIdFromCtx ä» context è·å–ç”¨æˆ· ID
func (l *GetProfileLogic) getUserIdFromCtx() (int64, error) {
    value := l.ctx.Value("userId")
    if value == nil {
        return 0, errors.New("userId not found in context")
    }

    // go-zero å­˜å‚¨çš„æ˜¯ json.Number ç±»å‹
    switch v := value.(type) {
    case json.Number:
        return v.Int64()
    case float64:
        return int64(v), nil
    case int64:
        return v, nil
    default:
        return 0, errors.New("invalid userId type")
    }
}
```

### 6.5 å…³é”®é…ç½®

**æ‰€æœ‰ API æœåŠ¡å¿…é¡»ä½¿ç”¨ç›¸åŒçš„ AccessSecretï¼**

```yaml
# user-api.yaml
Auth:
  AccessSecret: "your-secret-key-32-chars-long-xxx"
  AccessExpire: 7200

# activity-api.yaml ï¼ˆå¿…é¡»ä¸ user-api ä¸€è‡´ï¼‰
Auth:
  AccessSecret: "your-secret-key-32-chars-long-xxx"
  AccessExpire: 7200

# chat-api.yaml ï¼ˆå¿…é¡»ä¸ user-api ä¸€è‡´ï¼‰
Auth:
  AccessSecret: "your-secret-key-32-chars-long-xxx"
  AccessExpire: 7200
```

---

## 7. ç½‘å…³é…ç½®

### 7.1 Nginx ç½‘å…³è¯´æ˜

ç½‘å…³ä½¿ç”¨ **Nginx**ï¼Œåªè´Ÿè´£è·¯ç”±åˆ†å‘ï¼Œä¸åšä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚

é…ç½®æ–‡ä»¶ï¼š`deploy/nginx/gateway.conf`

```nginx
upstream user_api {
    server user-api:8001;
}

upstream activity_api {
    server activity-api:8002;
}

upstream chat_api {
    server chat-api:8003;
}

server {
    listen 8888;

    # ç”¨æˆ·æœåŠ¡
    location /api/v1/user/ {
        proxy_pass http://user_api;
        proxy_set_header Authorization $http_authorization;
    }

    # æ´»åŠ¨æœåŠ¡
    location /api/v1/activity/ {
        proxy_pass http://activity_api;
        proxy_set_header Authorization $http_authorization;
    }

    # èŠå¤©æœåŠ¡
    location /api/v1/chat/ {
        proxy_pass http://chat_api;
        proxy_set_header Authorization $http_authorization;
    }

    # å¥åº·æ£€æŸ¥
    location /health {
        return 200 '{"status":"ok"}';
    }
}
```

### 7.2 å¼€å‘ç¯å¢ƒ

å¼€å‘æ—¶å¯ä»¥ç›´æ¥è®¿é—®å„ API æœåŠ¡ï¼Œæ— éœ€å¯åŠ¨ Nginxï¼š

```bash
# ç›´æ¥è®¿é—® user-api
curl http://localhost:8001/api/v1/user/login

# ç›´æ¥è®¿é—® activity-api
curl http://localhost:8002/api/v1/activity/list
```

### 7.3 ç”Ÿäº§ç¯å¢ƒ

ç”Ÿäº§ç¯å¢ƒé€šè¿‡ Nginx ç»Ÿä¸€å…¥å£ï¼š

```bash
# æ‰€æœ‰è¯·æ±‚èµ° Nginx
curl http://api.example.com:8888/api/v1/user/login
curl http://api.example.com:8888/api/v1/activity/list
```

---

## 8. å„æœåŠ¡èŒè´£è¯´æ˜

### 8.1 user æœåŠ¡

| å±‚çº§ | èŒè´£ |
|------|------|
| **user-api** | ç™»å½•ã€æ³¨å†Œã€Tokenç­¾å‘ã€è·å–ç”¨æˆ·ä¿¡æ¯ |
| **user-rpc** | ç”¨æˆ·CRUDã€å¯†ç éªŒè¯ã€ä¿¡æ¯æŸ¥è¯¢ |

### 8.2 activity æœåŠ¡

| å±‚çº§ | èŒè´£ |
|------|------|
| **activity-api** | æ´»åŠ¨åˆ—è¡¨ã€è¯¦æƒ…ã€åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€æŠ¥åã€ç­¾åˆ° |
| **activity-rpc** | æ´»åŠ¨CRUDã€æŠ¥åé€»è¾‘ã€ç­¾åˆ°é€»è¾‘ã€åº“å­˜æ‰£å‡ |

### 8.3 chat æœåŠ¡

| å±‚çº§ | èŒè´£ |
|------|------|
| **chat-api** | èŠå¤©å®¤åˆ—è¡¨ã€æ¶ˆæ¯å†å²ã€å‘é€æ¶ˆæ¯ |
| **chat-rpc** | æ¶ˆæ¯å­˜å‚¨ã€èŠå¤©å®¤ç®¡ç† |
| **chat-ws** | WebSocket å®æ—¶é€šä¿¡ |

---

## 9. å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä¸åœ¨ Nginx åšé‰´æƒï¼Ÿ

A: go-zero å†…ç½®çš„ jwt:Auth å·²ç»è¶³å¤Ÿå¥½ç”¨ï¼Œåœ¨å„æœåŠ¡å†…éªŒè¯æ›´ç®€å•ã€‚å¦‚æœåœ¨ Nginx åšï¼Œéœ€è¦é¢å¤–é…ç½® auth_request æ¨¡å—ï¼Œå¢åŠ å¤æ‚åº¦ã€‚

### Q2: Token è¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ

A: å¯ä»¥å®ç°åŒ Token æœºåˆ¶ï¼ˆAccess Token + Refresh Tokenï¼‰ï¼Œæˆ–è€…è®©ç”¨æˆ·é‡æ–°ç™»å½•ã€‚

### Q3: å¦‚ä½•åœ¨ RPC å±‚è·å–ç”¨æˆ· IDï¼Ÿ

A: API å±‚è°ƒç”¨ RPC æ—¶ï¼Œå¯ä»¥å°† userId ä½œä¸ºå‚æ•°ä¼ é€’ï¼š

```go
// API logic
userId := l.ctx.Value("userId")
l.svcCtx.ActivityRpc.CreateActivity(l.ctx, &pb.CreateActivityReq{
    CreatorId: userId,  // å°† userId ä¼ é€’ç»™ RPC
    Title:     req.Title,
})
```

### Q4: æœåŠ¡ä¹‹é—´å¦‚ä½•è°ƒç”¨ï¼Ÿ

A: é€šè¿‡ gRPC + Etcd æœåŠ¡å‘ç°ï¼š

```go
// activity-api è°ƒç”¨ user-rpc
user, err := l.svcCtx.UserRpc.GetUserInfo(l.ctx, &userpb.GetUserInfoReq{
    UserId: creatorId,
})
```

### Q5: å¦‚ä½•æ·»åŠ æ–°æ¥å£ï¼Ÿ

1. ä¿®æ”¹ `.api` æ–‡ä»¶ï¼Œæ·»åŠ æ–°æ¥å£å®šä¹‰
2. é‡æ–°è¿è¡Œ `goctl api go -api desc/xxx.api -dir . -style go_zero`
3. å®ç°æ–°ç”Ÿæˆçš„ logic æ–‡ä»¶
