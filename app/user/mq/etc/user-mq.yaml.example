# ============================================================================
# User MQ 消费者服务配置（基于 Watermill Redis Stream）
# ============================================================================
#
# 使用方法：复制本文件为 user-mq.yaml，然后修改配置
#   cp user-mq.yaml.example user-mq.yaml
#
# 启动命令: go run user_mq.go -f etc/user-mq.yaml
#
# 订阅 Topic:
#   - credit:events  → 信用分变更事件（来自 Activity 服务）
#   - verify:events  → 认证申请事件（来自 User RPC，触发 OCR 处理）
#
# 后台任务:
#   - TimeoutScanner → 每分钟扫描超时的 OcrPending 记录
#
# ============================================================================

Name: user-mq
Mode: dev

# 日志配置
Log:
  ServiceName: user-mq
  Mode: console
  Encoding: plain
  Level: info
  Path: ./logs

# 数据库配置
MySQL:
  DataSource: root:your_password@tcp(127.0.0.1:3306)/campushub_user?charset=utf8mb4&parseTime=true&loc=Local

# Redis 配置（用于缓存操作）
BizRedis:
  Host: 127.0.0.1:6379
  Type: node
  Pass: ""

# ==================== 消息中间件配置（Watermill）====================
# 复用 common/messaging 库
Messaging:
  # Redis 连接配置（用于 Stream）
  Redis:
    Addr: "127.0.0.1:6379"
    Password: ""
    DB: 0

  # 信用事件主题（Stream Key）
  Topic: "credit:events"

  # 认证事件主题（Stream Key）
  VerifyTopic: "verify:events"

  # 消费者组名称
  ConsumerGroup: "user-mq-group"

  # 是否启用 Prometheus 指标
  EnableMetrics: true

  # 是否启用 Go-Zero trace_id 传播
  EnableGoZero: true

  # 重试配置
  Retry:
    MaxRetries: 3
    InitialInterval: 100ms
    MaxInterval: 10s
    Multiplier: 2.0

# ==================== OCR 配置（学生认证 OCR 处理）====================
# 说明：MQ 消费者接收认证事件后调用 OCR 识别
Ocr:
  # 腾讯云 OCR（主提供商）
  Tencent:
    Enabled: false
    SecretId: your-tencent-secret-id
    SecretKey: your-tencent-secret-key
    Region: "ap-guangzhou"
    Endpoint: "ocr.tencentcloudapi.com"
    Timeout: 30
  # 阿里云 OCR（备用提供商）
  Aliyun:
    Enabled: false
    AccessKeyId: "your-aliyun-access-key-id"
    AccessKeySecret: "your-aliyun-access-key-secret"
    Endpoint: "ocr-api.cn-hangzhou.aliyuncs.com"
    Timeout: 30
