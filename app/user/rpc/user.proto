// ============================================================================
// User 模块 Proto 定义文件
// ============================================================================
//
// 文件说明：
//   定义 User 模块的内部 gRPC 服务接口，供【其他微服务】调用。
//   不对外暴露，不经过 Gateway。
//
// 包含服务：
//   - CreditService: 信用分服务
//   - VerifyService: 学生认证服务
//
// 调用方：
//   - Activity RPC（报名/发布权限校验）
//   - MQ Consumer（信用分变更）
//   - User API（查询信用信息）
//
// 字段编号规划：
//   - 1-30: 基础字段
//   - 31-50: 扩展字段
//   警告：字段编号一旦发布使用后不可更改或复用！
//
// 生成命令：
//   cd app/user/rpc
//   goctl rpc protoc user.proto --go_out=./pb --go-grpc_out=./pb --zrpc_out=. -style go_zero
//
// ============================================================================

syntax = "proto3";

package user;

option go_package = "./pb";

// ============================================================================
// CreditService 信用分服务
// ============================================================================
// 提供信用分相关的内部RPC接口
// 调用方: Activity服务、User API、MQ Consumer等
// ============================================================================

service CreditService {
    // ==================== 查询类接口 ====================

    // GetCreditInfo 获取用户信用信息
    // 调用方: User API（个人中心-信用信息页面）
    // 业务逻辑: 返回用户当前的信用分、等级、特权信息
    rpc GetCreditInfo(GetCreditInfoReq) returns (GetCreditInfoResp);

    // GetCreditLogs 获取信用变更记录列表
    // 调用方: User API（信用分明细页面）
    // 业务逻辑: 分页查询用户的信用变更记录，支持按类型和时间筛选
    rpc GetCreditLogs(GetCreditLogsReq) returns (GetCreditLogsResp);

    // CanParticipate 校验是否允许报名
    // 调用方: Activity服务（报名模块）
    // 业务逻辑:
    //   - score < 60: 黑名单，禁止报名
    //   - 60 <= score < 70: 风险用户，每日限报名1次
    //   - score >= 70: 正常报名
    rpc CanParticipate(CanParticipateReq) returns (CanParticipateResp);

    // CanPublish 校验是否允许发布活动
    // 调用方: Activity服务（发布模块）
    // 业务逻辑:
    //   - score >= 90: 允许发布（Lv3优秀用户、Lv4社区之星）
    //   - score < 90: 禁止发布
    rpc CanPublish(CanPublishReq) returns (CanPublishResp);

    // ==================== 写入类接口 ====================

    // InitCredit 初始化信用分
    // 调用方: User服务（注册流程）
    // 业务逻辑: 用户注册成功后初始化信用分为100分（Lv4社区之星）
    rpc InitCredit(InitCreditReq) returns (InitCreditResp);

    // UpdateScore 变更信用分
    // 调用方: MQ Consumer（内部系统）
    // 业务逻辑: 签到、爽约、活动结束等事件触发信用分变更
    // 幂等保证: 通过 source_id 实现幂等
    rpc UpdateScore(UpdateScoreReq) returns (UpdateScoreResp);

}



// ============================================================================
// CreditService 消息定义
// ============================================================================

// ==================== GetCreditInfo 获取信用信息 ====================

// GetCreditInfoReq 获取信用信息请求
message GetCreditInfoReq {
    // 用户ID
    int64 user_id = 1;
}

// GetCreditInfoResp 获取信用信息响应
message GetCreditInfoResp {
    // 用户ID
    int64 user_id = 1;
    // 当前信用分（0-100）
    int64 score = 2;
    // 当前信用等级（0-黑名单,1-风险,2-良好,3-优秀,4-社区之星）
    int32 level = 3;
    // 等级名称
    string level_name = 4;
    // 是否可发布活动
    bool can_publish = 5;
    // 是否可报名活动
    bool can_participate = 6;
    // 创建时间（Unix时间戳秒）
    int64 created_at = 7;
    // 更新时间（Unix时间戳秒）
    int64 updated_at = 8;
}

// ==================== GetCreditLogs 获取信用变更记录列表 ====================

// GetCreditLogsReq 获取信用变更记录请求
message GetCreditLogsReq {
    // 用户ID
    int64 user_id = 1;
    // 变动类型筛选（0=全部，其他值参见变动类型说明）
    int32 change_type = 2;
    // 开始时间戳（秒），0表示不限
    int64 start_time = 3;
    // 结束时间戳（秒），0表示不限
    int64 end_time = 4;
    // 页码，从1开始
    int32 page = 5;
    // 每页条数，默认20，最大50
    int32 page_size = 6;
}

// CreditLogItem 信用变更记录项
message CreditLogItem {
    // 记录ID
    int64 id = 1;
    // 用户ID
    int64 user_id = 2;
    // 变动类型
    int32 change_type = 3;
    // 变动类型名称
    string change_type_name = 4;
    // 变动分值（正数加分，负数扣分）
    int32 delta = 5;
    // 业务来源ID
    string source_id = 6;
    // 变动原因
    string reason = 7;
    // 变动前分数
    int32 before_score = 8;
    // 变动后分数
    int32 after_score = 9;
    // 变动时间戳（秒）
    int64 created_at = 10;
}

// GetCreditLogsResp 获取信用变更记录响应
message GetCreditLogsResp {
    // 记录列表
    repeated CreditLogItem list = 1;
    // 总记录数
    int64 total = 2;
    // 当前页码
    int32 page = 3;
    // 每页条数
    int32 page_size = 4;
}

// ==================== CanParticipate 校验报名资格 ====================

// CanParticipateReq 校验报名资格请求
message CanParticipateReq {
    // 用户ID
    int64 user_id = 1;
}

// CanParticipateResp 校验报名资格响应
message CanParticipateResp {
    // 是否允许报名
    bool allowed = 1;
    // 不允许时的原因（allowed=true时为空）
    // 示例: "信用分过低(<60)，账户已被限制报名"
    // 示例: "信用分处于风险区间(60-69)，每日仅限报名1次，今日已用完"
    string reason = 2;
    // 当前信用分
    int64 score = 3;
    // 当前信用等级
    int32 level = 4;
}

// ==================== CanPublish 校验发布资格 ====================

// CanPublishReq 校验发布资格请求
message CanPublishReq {
    // 用户ID
    int64 user_id = 1;
}

// CanPublishResp 校验发布资格响应
message CanPublishResp {
    // 是否允许发布
    bool allowed = 1;
    // 不允许时的原因
    // 示例: "信用分不足90，暂时无法发布活动，请先通过参与活动积累信用"
    string reason = 2;
    // 当前信用分
    int64 score = 3;
    // 当前信用等级
    int32 level = 4;
}

// ==================== InitCredit 初始化信用分 ====================

// InitCreditReq 初始化信用分请求
message InitCreditReq {
    // 用户ID
    int64 user_id = 1;
}

// InitCreditResp 初始化信用分响应
message InitCreditResp {
    // 是否成功
    bool success = 1;
    // 初始化后的分数（100分）
    int64 score = 2;
    // 初始化后的等级（4-社区之星）
    int32 level = 3;
}

// ==================== UpdateScore 变更信用分 ====================

// UpdateScoreReq 变更信用分请求
message UpdateScoreReq {
    // 用户ID
    int64 user_id = 1;
    // 变动类型（详见枚举说明）
    // 1-注册初始化, 2-正常履约(+2), 3-提前24h取消(0),
    // 4-临期取消(-5), 5-爽约(-10), 6-圆满举办(+5),
    // 7-删除活动(-10), 99-管理员调整
    int32 change_type = 2;
    // 业务来源ID（幂等键，格式: "业务类型:业务ID"）
    // 示例: "activity:1001", "checkin:1001:10001"
    string source_id = 3;
    // 变动原因描述
    // 示例: "活动[周末篮球赛]签到成功"
    string reason = 4;
    // 管理员调整时的分值（仅change_type=99时有效）
    int64 admin_delta = 5;
}

// UpdateScoreResp 变更信用分响应
message UpdateScoreResp {
    // 是否成功
    bool success = 1;
    // 变动前分数
    int64 before_score = 2;
    // 变动后分数
    int64 after_score = 3;
    // 实际变动值（正数加分，负数扣分）
    int64 delta = 4;
    // 变动后等级
    int32 new_level = 5;
}

// ============================================================================
// 信用等级说明（仅供参考，实际在 Go 代码中定义常量）
// ============================================================================
//
// Level 0: 黑名单 (score < 60)
//   - 权限: 全站封禁，禁止报名，禁止发布
//
// Level 1: 信用风险 (60 <= score < 70)
//   - 权限: 禁止发布活动，每日仅限报名1次
//
// Level 2: 良好用户 (70 <= score < 90)
//   - 权限: 禁止发布活动，正常报名
//
// Level 3: 优秀用户 (90 <= score < 95)
//   - 权限: 允许发布活动，正常报名
//
// Level 4: 社区之星 (score >= 95)
//   - 权限: 允许发布活动，优先展示，报名无限制
//   - 新用户初始100分，属于此等级
//
// ============================================================================
// 信用变动类型说明
// ============================================================================
//
// ChangeType 1: 注册初始化 -> 设为100分
// ChangeType 2: 正常履约/签到成功 -> +2
// ChangeType 3: 提前24h取消 -> 0（无责取消）
// ChangeType 4: 临期取消(<24h) -> -5
// ChangeType 5: 爽约/未签到 -> -10
// ChangeType 6: 圆满举办活动 -> +5（组织者奖励）
// ChangeType 7: 删除已有报名的活动 -> -10（组织者惩罚）
// ChangeType 99: 管理员人工调整 -> 分值由admin_delta指定
//
// ============================================================================

// ============================================================================
// VerifyService 学生认证服务
// ============================================================================
// 提供学生身份认证相关的内部RPC接口
// 调用方: User API、Activity服务、MQ Consumer等
// 
// 状态机说明：
//   0:初始化  1:OCR审核中  2:待用户确认  3:人工审核中
//   4:已通过  5:已拒绝     6:已超时      7:已取消  8:OCR失败
// ============================================================================

service VerifyService {
    // ==================== 查询类接口（供 User API 调用） ====================

    // GetVerifyCurrent 获取当前认证进度
    // 调用方: User API（进入认证页面时调用）
    // 业务逻辑: 返回用户当前的认证状态、可执行的操作、OCR识别数据等
    rpc GetVerifyCurrent(GetVerifyCurrentReq) returns (GetVerifyCurrentResp);

    // GetVerifyInfo 获取已通过的认证信息
    // 调用方: User API（个人中心-认证信息页面）
    // 业务逻辑: 仅返回已通过认证用户的脱敏信息
    rpc GetVerifyInfo(GetVerifyInfoReq) returns (GetVerifyInfoResp);

    // IsVerified 查询用户是否已完成学生认证
    // 调用方: Activity服务（报名/发布活动前校验）
    // 场景: 需要确认用户学生身份时调用
    rpc IsVerified(IsVerifiedReq) returns (IsVerifiedResp);

    // ==================== 写入类接口（供 User API 调用） ====================

    // ApplyStudentVerify 提交学生认证申请
    // 调用方: User API
    // 业务逻辑:
    //   1. 限流检查（20s内≤2次）
    //   2. 唯一性校验（学校+学号）
    //   3. 状态机校验
    //   4. 创建记录并触发OCR
    rpc ApplyStudentVerify(ApplyStudentVerifyReq) returns (ApplyStudentVerifyResp);

    // ConfirmStudentVerify 用户确认/修改认证信息
    // 调用方: User API
    // 业务逻辑:
    //   - 确认无误 -> 状态改为4（已通过）
    //   - 修改信息 -> 状态改为3（人工审核）
    rpc ConfirmStudentVerify(ConfirmStudentVerifyReq) returns (ConfirmStudentVerifyResp);

    // CancelStudentVerify 取消认证申请
    // 调用方: User API
    // 业务逻辑: 状态改为7（已取消）
    rpc CancelStudentVerify(CancelStudentVerifyReq) returns (CancelStudentVerifyResp);

    // ==================== 内部接口（供 MQ Consumer / 定时任务 调用） ====================

    // UpdateVerifyStatus 更新认证状态
    // 调用方: MQ Consumer（OCR回调、人工审核结果）、定时任务（超时处理）
    // 业务逻辑: 处理认证流程中的状态流转
    rpc UpdateVerifyStatus(UpdateVerifyStatusReq) returns (UpdateVerifyStatusResp);
}

// ============================================================================
// VerifyService 消息定义
// ============================================================================

// ==================== GetVerifyCurrent 获取当前认证进度 ====================

// GetVerifyCurrentReq 获取当前认证进度请求
message GetVerifyCurrentReq {
    // 用户ID
    int64 user_id = 1;
}

// GetVerifyCurrentResp 获取当前认证进度响应
message GetVerifyCurrentResp {
    // 是否有认证记录
    bool has_record = 1;
    // 当前认证ID（无记录时为0）
    int64 verify_id = 2;
    // 当前状态码（-1=未申请,0=初始,1=OCR中,2=待确认,3=人工审核,4=通过,5=拒绝,6=超时,7=取消,8=OCR失败）
    int32 status = 3;
    // 状态描述
    string status_desc = 4;
    // 是否可以提交新申请
    bool can_apply = 5;
    // 是否可以确认/修改
    bool can_confirm = 6;
    // 是否可以取消
    bool can_cancel = 7;
    // 前端应执行的动作
    // apply=显示申请表单, wait_ocr=等待OCR, confirm=显示确认页
    // wait_manual=等待人工审核, done=认证完成, rejected=被拒绝可重新申请
    string need_action = 8;
    // OCR识别数据（待确认/已通过时返回）
    VerifyOcrData verify_data = 9;
    // 拒绝原因（被拒绝时返回）
    string reject_reason = 10;
    // 申请时间（Unix时间戳秒）
    int64 created_at = 11;
    // 最后更新时间（Unix时间戳秒）
    int64 updated_at = 12;
}

// ==================== GetVerifyInfo 获取已通过的认证信息 ====================

// GetVerifyInfoReq 获取认证信息请求
message GetVerifyInfoReq {
    // 用户ID
    int64 user_id = 1;
}

// GetVerifyInfoResp 获取认证信息响应
message GetVerifyInfoResp {
    // 是否已认证
    bool is_verified = 1;
    // 认证ID
    int64 verify_id = 2;
    // 真实姓名（脱敏：张*）
    string real_name = 3;
    // 学校名称
    string school_name = 4;
    // 学号（脱敏：202301****）
    string student_id = 5;
    // 院系
    string department = 6;
    // 入学年份
    string admission_year = 7;
    // 认证通过时间（Unix时间戳秒）
    int64 verified_at = 8;
}

// ==================== IsVerified 查询认证状态 ====================

// IsVerifiedReq 查询学生认证状态请求
message IsVerifiedReq {
    // 用户ID
    int64 user_id = 1;
}

// IsVerifiedResp 查询学生认证状态响应
message IsVerifiedResp {
    // 是否已完成学生认证
    bool is_verified = 1;
    // 学校名称（已认证时返回，未认证为空）
    string school_name = 2;
    // 学号-脱敏（已认证时返回，如 "202301****"）
    string student_id = 3;
    // 院系（已认证时返回）
    string department = 4;
    // 入学年份（已认证时返回，如 "2023"）
    string admission_year = 5;
    // 认证通过时间（Unix时间戳秒，未认证时为0）
    int64 verified_at = 6;
}

// ==================== ApplyStudentVerify 提交学生认证申请 ====================

// ApplyStudentVerifyReq 提交认证申请请求
message ApplyStudentVerifyReq {
    // 用户ID
    int64 user_id = 1;
    // 真实姓名
    string real_name = 2;
    // 学校名称
    string school_name = 3;
    // 学号
    string student_id = 4;
    // 院系
    string department = 5;
    // 入学年份
    string admission_year = 6;
    // 学生证正面图片URL
    string front_image_url = 7;
    // 学生证详情面图片URL
    string back_image_url = 8;
}

// ApplyStudentVerifyResp 提交认证申请响应
message ApplyStudentVerifyResp {
    // 认证申请ID
    int64 verify_id = 1;
    // 当前状态码（1=OCR审核中）
    int32 status = 2;
    // 状态描述
    string status_desc = 3;
    // 申请时间（Unix时间戳秒）
    int64 created_at = 4;
}

// ==================== ConfirmStudentVerify 用户确认/修改 ====================

// ConfirmStudentVerifyReq 确认/修改认证信息请求
message ConfirmStudentVerifyReq {
    // 用户ID（用于鉴权校验）
    int64 user_id = 1;
    // 认证申请ID
    int64 verify_id = 2;
    // true=确认无误，false=需要修改
    bool is_confirmed = 3;
    // 用户修改后的数据（is_confirmed=false时必填）
    VerifyModifiedData modified_data = 4;
}

// VerifyModifiedData 用户修改后的数据
message VerifyModifiedData {
    // 真实姓名
    string real_name = 1;
    // 学校名称
    string school_name = 2;
    // 学号
    string student_id = 3;
    // 院系
    string department = 4;
    // 入学年份
    string admission_year = 5;
}

// ConfirmStudentVerifyResp 确认/修改认证信息响应
message ConfirmStudentVerifyResp {
    // 认证申请ID
    int64 verify_id = 1;
    // 更新后的状态码（4=通过，3=人工审核）
    int32 new_status = 2;
    // 状态描述
    string new_status_desc = 3;
}

// ==================== CancelStudentVerify 取消认证申请 ====================

// CancelStudentVerifyReq 取消认证申请请求
message CancelStudentVerifyReq {
    // 用户ID（用于鉴权校验）
    int64 user_id = 1;
    // 认证申请ID
    int64 verify_id = 2;
    // 取消原因（可选）
    string cancel_reason = 3;
}

// CancelStudentVerifyResp 取消认证申请响应
message CancelStudentVerifyResp {
    // 认证申请ID
    int64 verify_id = 1;
    // 更新后的状态码（7=已取消）
    int32 new_status = 2;
    // 状态描述
    string new_status_desc = 3;
}

// ==================== UpdateVerifyStatus 更新认证状态 ====================

// UpdateVerifyStatusReq 更新认证状态请求
message UpdateVerifyStatusReq {
    // 认证记录ID
    int64 verify_id = 1;
    // 用户ID
    int64 user_id = 2;
    // 新状态
    // 1-OCR审核中, 2-待确认, 3-人工审核中, 4-已通过, 5-已拒绝, 6-已超时, 7-已取消, 8-OCR失败
    int32 new_status = 3;
    // OCR识别数据（状态为2-待确认时填充）
    VerifyOcrData ocr_data = 4;
    // 拒绝原因（状态为5-已拒绝时填充）
    string reject_reason = 5;
    // 操作来源
    // 示例: "ocr_callback", "manual_review", "timeout_job"
    string operator = 6;
}

// VerifyOcrData OCR识别数据
message VerifyOcrData {
    // 真实姓名
    string real_name = 1;
    // 学校名称
    string school_name = 2;
    // 学号
    string student_id = 3;
    // 院系
    string department = 4;
    // 入学年份
    string admission_year = 5;
    // OCR平台
    string ocr_platform = 6;
    // OCR置信度
    double ocr_confidence = 7;
    // OCR原始响应JSON
    string ocr_raw_json = 8;
}

// UpdateVerifyStatusResp 更新认证状态响应
message UpdateVerifyStatusResp {
    // 是否成功
    bool success = 1;
    // 更新前状态
    int32 before_status = 2;
    // 更新后状态
    int32 after_status = 3;
}

// ============================================================================
// 认证状态说明（仅供参考，实际在 Go 代码中定义常量）
// ============================================================================
//
// Status -1: 未申请（无认证记录）
// Status 0: 初始化（可申请）
// Status 1: OCR审核中（图片已上传，等待OCR识别）
// Status 2: 待用户确认（OCR识别完成，等待用户确认/修改）
// Status 3: 人工审核中（用户修改了信息，需人工复核）
// Status 4: 已通过（认证成功，最终状态）
// Status 5: 已拒绝（认证失败，24h后可重新申请）
// Status 6: 已超时（10分钟未完成OCR，可重新申请）
// Status 7: 已取消（用户主动取消，可重新申请）
// Status 8: OCR失败（双OCR都失败，可重试）
//
// 状态流转规则：
//   0(初始) -> 1(OCR审核中)
//   1(OCR审核中) -> 2(待确认) | 6(超时) | 7(取消) | 8(OCR失败)
//   2(待确认) -> 4(通过) | 3(人工审核) | 7(取消)
//   3(人工审核) -> 4(通过) | 5(拒绝) | 7(取消)
//   5,6,7,8 -> 0(初始) [允许重新申请]
//
// ============================================================================

// ============================================================================
// TagService 标签服务
// ============================================================================

service TagService {
    // 马肖阳的标签接口
    rpc GetAllTags(GetAllTagsReq) returns (GetAllTagsResp);
    rpc GetTagsByIds(GetTagsByIdsReq) returns (GetTagsByIdsResp);
    rpc GetUserTags(GetUserTagsReq) returns (GetUserTagsResponse);
}

message GetAllTagsReq {
    int64 since_timestamp = 1;
}

message GetAllTagsResp {
    repeated TagInfo tags = 1;
    int64 server_timestamp = 2;
}

message GetTagsByIdsReq {
    repeated int64 ids = 1;
}

message GetTagsByIdsResp {
    repeated TagInfo tags = 1;
    repeated int64 invalid_ids = 2;
}

message TagInfo {
    uint64 id = 1;
    string name = 2;
    string color = 3;
    string icon = 4;
    uint64 status = 5;
    string description = 6;
    int64 created_at = 7;
    int64 updated_at = 8;
}

message GetUserTagsReq {
    int64 user_id =1;
}

message GetUserTagsResponse {
    repeated UserTag tags = 1;
}

message UserTag {
    uint64 id = 1;
    string name = 2;
}

// ============================================================================
// UserBasicService 用户信息服务
// ============================================================================

service UserBasicService {
    // 批量获取群聊用户的信息
    rpc GetGroupUser(GetGroupUserReq) returns (GetGroupUserResponse);
    // 用户登录
    rpc Login(LoginReq) returns (LoginResponse);
    // 用户登出
    rpc Logout(LogoutReq) returns (LogoutResponse);
    // 用户注册
    rpc Register(RegisterReq) returns (RegisterResponse);
    // 刷新短token
    rpc RefreshToken(RefreshReq) returns(RefreshResponse);
    // 获取用户的信息
    rpc GetUserInfo(GetUserInfoReq) returns(GetUserInfoResponse);
}

message GetGroupUserReq {
    // 使用 repeated 表示数组/列表
    repeated int64 ids = 1;
}

message GetGroupUserResponse {
    // 使用 repeated 返回对象列表
    repeated GroupUserInfo users = 1;
}

message GroupUserInfo {
    uint64 id = 1;
    string avatar_url = 2;
    string nickname = 3;
}

// 登录接口
message LoginReq {
    string qq_email = 1;        // 对应 "qqEmail"
    string password = 2;        // 对应 "password"
    string lot_number = 3;      // 对应 "lotNumber"
    string captcha_output = 4;  // 对应 "captchaOutput"
    string pass_token = 5;      // 对应 "passToken"
    string gen_time = 6;        // 对应 "genTime"
}

message LoginResponse {
    string access_token = 1;    // 对应 "accessToken"
    string refresh_token = 2;   // 对应 "refreshToken"
    LoginUserInfo user_info = 3; // 对应 "userInfo"
}

message LoginUserInfo {
    UserInfo user_info = 1;
}

// 用户登出
message LogoutReq {
    int64 user_id = 1;// 从token解析的id
    string access_token = 2;// 从请求头中获取的token
}

message LogoutResponse {
}

// 用户注册
message RegisterReq {
    string qq_email = 1;  // 对应 "qqEmail"
    string qq_code = 2;   // 对应 "qqCode" (通常是验证码)
    string password = 3;  // 对应 "password"
    string nickname = 4;  // 对应 "nickname"
}

message RegisterResponse {
    string access_token = 1;    // 对应 "accessToken"
    string refresh_token = 2;   // 对应 "refreshToken"
    UserInfo user_info = 3;
}

// 获取用户信息
message GetUserInfoReq {
    int64 user_id = 1;
}

message GetUserInfoResponse {
    UserInfo user_info = 1;
}

// 公用结构体
message InterestTag {
    uint64 id = 1;
    string tag_name = 2;        // 对应 "tagName"
    string tag_icon = 3;        // 对应 "tagIcon"
    string tag_desc = 4;        // 对应 "tagDesc"
    string tag_color = 5;       // 对应 "tagColor"
}

message UserInfo {
    uint64 user_id = 1;         // 对应 "userId"
    string nickname = 2;        // 对应 "nickname"
    string avatar_url = 3;      // 对应 "avatarUrl"
    string introduction = 4;    // 对应 "introduction"
    string gender = 5;          // 对应 "gender"
    string age = 6;             // 对应 "age"
    uint32 activities_num = 7;  // 对应 "activitiesNum"
    uint32 initiate_num = 8;    // 对应 "initiateNum"
    int64 credit = 9;           // 对应 "credit" (参考你CreditService的定义)
    bool is_student_verified = 10; // 对应 "isStudentVerified"
    repeated InterestTag interest_tags = 11; // 对应 "interestTags" 列表
}

// 刷新token
message RefreshReq {
    string refresh_token = 1;
}

message RefreshResponse {
    string access_token = 1;
}

// 验证码服务
service CaptchaService {
    rpc GetCaptchaConfig(GetCaptchaConfigReq) returns(GetCaptchaConfigResponse);
    rpc CheckCaptcha(CheckCaptchaReq) returns(CheckCaptchaResponse);
}

// 获取验证码配置信息
message GetCaptchaConfigReq{
}

message GetCaptchaConfigResponse{
    string captcha_id = 1;
}

// 校验验证码是否正确
message CheckCaptchaReq{
    string lotNumber = 1;
    string captchaOutput = 2;
    string passToken = 3;
    string genTime = 4;
}

message CheckCaptchaResponse{
    string result = 1;          // "result": "success" 或 "fail"
    string reason = 2;          // "reason": 失败原因
    CaptchaArgs captcha_args = 3; // 嵌套对象 "captcha_args"
}

message CaptchaArgs{
    string captcha_id = 1;     // "captcha_id"
    string lot_number = 2;     // "lot_number"
    string captcha_output = 3; // "captcha_output"
    string pass_token = 4;     // "pass_token"
    string gen_time = 5;       // "gen_time"
}

service QQEmail{
    rpc SendQQEmail(SendQQEmailReq) returns(SendQQEmailResponse);
    rpc CheckQQEmail(CheckQQEmailReq) returns(CheckQQEmailResponse);
}

// 发送QQ邮箱
message SendQQEmailReq{
    string qq_email =1;
    string scene =2;
}

message SendQQEmailResponse{

}

// 校验QQ邮箱
message CheckQQEmailReq{
    string qq_email =1;
    string qq_code =2;
    string scene =3;
}

message CheckQQEmailResponse{
    bool isValid =1;
}